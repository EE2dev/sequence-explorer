!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("d3"),require("d3-interpolate"),require("d3-array"),require("d3-scale"),require("d3-collection")):"function"==typeof define&&define.amd?define(["exports","d3","d3-interpolate","d3-array","d3-scale","d3-collection"],t):t(e.sequenceExplorer=e.sequenceExplorer||{},e.d3,e.d3,e.d3,e.d3,e.d3)}(this,function(e,t,n,o,s,r){"use strict";function l(){function e(){w.forEach(function(e){e.sourceLinks=[],e.targetLinks=[]}),N.forEach(function(e){var t=e.source,n=e.target;"number"==typeof t&&(t=e.source=w[e.source]),"number"==typeof n&&(n=e.target=w[e.target]),t.sourceLinks.push(e),n.targetLinks.push(e)})}function t(){w.forEach(function(e){e.value=Math.max(o.sum(e.sourceLinks,c),o.sum(e.targetLinks,c))})}function l(){d=b?d:o.max(w,function(e){return e.value}),u=(v[1]/x.length-m)/d,y&&console.log("ky: "+u),w.forEach(function(e){e.dy=e.value*u,e.dx=h}),N.forEach(function(e){e.dy=e.value*u})}function a(){y&&console.log(v),f=s.scalePoint().domain(k).range([0,v[0]-h]),p=s.scalePoint().domain(x).range([v[1],v[1]/x.length]),w.forEach(function(e){e.x=f(e.nameX),e.y=p(e.nameY)-e.dy,y&&(console.log("x "+e.nameX+" -> "+e.x),console.log("y "+e.nameY+" -> "+e.y))}),y&&console.log(w)}function i(){function e(e,t){return e.source.y-t.source.y}function t(e,t){return e.target.y-t.target.y}w.forEach(function(n){n.sourceLinks.sort(t),n.targetLinks.sort(e)}),w.forEach(function(e){var t=0,n=0;e.sourceLinks.forEach(function(e){e.sy=t,t+=e.dy}),e.targetLinks.forEach(function(e){e.ty=n,n+=e.dy})})}function c(e){return e.value}var u,d,f,p,g={},y=!1,h=15,m=8,v=[700,500],k=[],x=[],b=!1,w=[],N=[];return g.debugOn=function(e){return arguments.length?(y=e,g):y},g.nodeWidth=function(e){return arguments.length?(h=+e,g):h},g.nodePadding=function(e){return arguments.length?(m=+e,g):m},g.nodes=function(e){return arguments.length?(w=e,g):w},g.links=function(e){return arguments.length?(N=e,g):N},g.sequence=function(e){return arguments.length?(k=e,g):k},g.categories=function(e){return arguments.length?(x=e,g):x},g.size=function(e){return arguments.length?(v=e,g):v},g.xScale=function(e){return arguments.length?(f=e,g):f},g.yScale=function(e){return arguments.length?(p=e,g):p},g.relayout=function(){return i(),g},g.link=function(){function e(e){var o=e.source.x+e.source.dx,s=e.target.x,r=n.interpolateNumber(o,s),l=r(t),a=r(1-t),i=e.source.y+e.sy+e.dy/2,c=e.target.y+e.ty+e.dy/2;return"M"+o+","+i+"C"+l+","+i+" "+a+","+c+" "+s+","+c}var t=.5;return e.curvature=function(n){return arguments.length?(t=+n,e):t},e},g.layout=function(){return e(),t(),l(),a(),i(),g},g.getNodeHeight=function(e){return e*u},g.maxValue=function(e){return arguments.length?-1===e?void(b=!1):(d=e,b=!0,g):d},g.addValues=function(){var e=r.map(),t=void 0;k.forEach(function(t){e.set(t,0)}),x.forEach(function(t){e.set(t,0)}),w.forEach(function(n){e.set(n.nameX,e.get(n.nameX)+n.value),e.set(n.nameY,e.get(n.nameY)+n.value),t=-1,k.forEach(function(e,o){e===n.nameX&&(t=o)}),0===t&&e.set("first"+k[0]+n.nameY,n.value),t!==k.length-1&&e.set("prev"+k[t+1]+n.nameY,n.value)}),w.forEach(function(t){t.valueX=e.get(t.nameX),t.valueY=e.get(t.nameY),t.valueYPrev=e.get("prev"+t.nameX+t.nameY),t.valueYFirst=e.get("first"+k[0]+t.nameY)})},g}function a(e){var n=19,o=19,s=e.style("width").indexOf("px");-1!=s&&(n+=+e.style("width").substr(0,s)),-1!=(s=e.style("height").indexOf("px"))&&(o+=+e.style("height").substr(0,s));var r=t.event.pageY-100<0?t.event.pageY+23:t.event.pageY-o,l=t.event.pageX+250<window.innerWidth?t.event.pageX+5:t.event.pageX-n;return e.style("top",r+"px").style("left",l+"px")}function i(e){var t=document.createElementNS("http://www.w3.org/2000/svg","g");t.setAttributeNS(null,"transform",e);var n=t.transform.baseVal.consolidate().matrix;return[n.e,n.f]}function c(e,n,o){if(isNaN(parseFloat(e)))return"-";var s=t.format(o);if("."===n){if(+e%1!=0)return s(e).split(".").join(",");return s(e).split(",").join(".")}return s(+e%1!=0?e:e)}function u(e){return void 0===e?t.ascending:function(t,n){return e.indexOf(t)-e.indexOf(n)}}function d(e,n,o,s,r,l){var a=n[0]-o.left-o.right,i=n[1]-o.bottom-o.top,c={left:0,bottom:0,right:0,top:20},u={left:20,bottom:0,right:0,top:20},d=e.append("g").attr("class","dummy d1").style("opacity",0).call(t.axisLeft(t.scalePoint().domain(s))),f=e.append("g").attr("class","dummy d2").style("opacity",0).call(t.axisBottom(t.scalePoint().domain(r)));c.left=d.node().getBBox().width,c.bottom=f.node().getBBox().height,a-=c.left,i=i-c.bottom-u.top,t.selectAll("g.dummy").remove();var p=t.scalePoint().domain(s).range([i,i/s.length]),g=t.axisLeft(p),y=e.append("g").attr("class","axis left").style("opacity",0).call(g);c.left=y.node().getBBox().width,y.attr("transform","translate("+(c.left-1.5)+", "+c.top+")"),t.selectAll("g.axis.left text").attr("dy","");var h=t.scalePoint().domain(r).range([0,a-l]),m=t.axisBottom(h);y=e.append("g").attr("class","axis bottom").style("opacity",0).call(m),c.bottom=y.node().getBBox().height,y.attr("transform","translate("+c.left+", "+(i+u.top)+")");var v={};return v.paddingSingle=c,v.paddingMultiples=u,v.width=a,v.height=i,v}function f(e,t,n,o,s){var r=t.width,l=t.height,a=t.paddingMultiples,i=o*r/n.cols,c=s*l/n.rows,u=(1/n.cols*r-a.left)/r,d=(1/n.rows*l-a.top)/l;u>=d?u=d:d=u;var f={};return f.sankeyFrame={},f.sankeyFrame.single="translate("+(i+r/2*u)+", "+(c+l/2*d)+") scale(0.3)",f.sankeyFrame.multiples="translate("+i+", "+c+") ",f.sankeySeq={},f.sankeySeq.single="translate("+t.paddingSingle.left+", 20)",f.sankeySeq.multiples="translate("+a.left+", "+a.top+") scale("+u+", "+d+")",f.pTop={},f.pTop.single="translate("+(a.left+r/2)+", "+(a.top-3)+")",f.pTop.multiples="translate("+(a.left+r/2*u)+", "+(a.top-3)+")",f.pLeft={},f.pLeft.single="translate("+(a.left-3)+", "+(a.top+l/2)+")",f.pLeft.multiples="translate("+(a.left-3)+", "+(a.top+l/2*d)+")",f}function p(e,n){var o=void 0!==n?n:t.transition().duration(1e3);return t.selectAll("g.sankeyFrame").each(function(){this===e?(console.log("clicked"),t.select(this).transition(o).attr("transform","translate(0, 0)"),t.select(this).selectAll("g.pTop").transition(o).attr("transform",function(e){return e.single}),t.select(this).selectAll("text.col.multiples").transition(o).style("opacity",0),t.select(this).selectAll("text.col.single").transition(o).style("opacity",1),t.select(this).selectAll("text.nodeLabel").transition(o).style("opacity",1),t.select(this).selectAll("g.pLeft").transition(o).style("opacity",0),t.select(this).selectAll(".sankeyNode,.sankeyNodeInfo").transition(o).style("stroke-width","1px"),t.select(this).selectAll("g.sankeySeq").transition(o).attr("transform",function(e){return e.single}),t.selectAll(".axis").transition().delay(800).style("opacity",1),t.selectAll(".coverSankeySeq").transition(o).style("opacity",0)):(console.log("not clicked"),t.select(this).transition(o).attr("transform",function(e){return e.single}).style("opacity",0),t.select(this).selectAll(".sankeyNode,.sankeyNodeInfo").transition(o).style("stroke-width","1px"))}),!1}function g(e){var n=t.transition().duration(1e3);return t.selectAll("g.sankeyFrame").each(function(){this===e?(console.log("clicked"),t.select(this).transition(n).attr("transform",function(e){return e.multiples}),t.select(this).selectAll("g.pTop").transition(n).attr("transform",function(e){return e.multiples}),t.select(this).selectAll("text.col.multiples").transition(n).style("opacity",1),t.select(this).selectAll("text.col.single").transition(n).style("opacity",0),t.select(this).selectAll("text.nodeLabel").transition(n).style("opacity",0),t.select(this).selectAll("g.pLeft").transition(n).style("opacity",1),t.select(this).selectAll(".sankeyNode,.sankeyNodeInfo").transition(n).style("stroke-width","0px"),t.select(this).selectAll("g.sankeySeq").transition(n).attr("transform",function(e){return e.multiples}),t.selectAll(".axis").transition(n).style("opacity",0),t.selectAll(".coverSankeySeq").transition(n).style("opacity",1)):(t.select(this).transition(n).attr("transform",function(e){return e.multiples}).style("opacity",1),t.select(this).selectAll(".sankeyNode,.sankeyNodeInfo").transition(n).style("stroke-width","0px"))}),!0}function y(e){function n(t){t.each(function(n){console.log(n),console.log("_myData "+e),void 0!==n?h(t,n):void 0!==e?m(e,t):m("<pre>",t)})}function o(e){var n=e.append("div").attr("class","sankeyMenu"),o=n.append("div").attr("class","OptionsMenu");if(o.append("div").attr("class","titleMenu").append("label").text("options"),1!==N.cols||1!==N.rows){o.append("span").attr("class","span1").append("input").attr("class","nodeScaling").attr("type","checkbox").on("change",s).node().checked=q,o.select("span.span1").append("label").text("global scale"),o.append("br")}if(o.append("span").attr("class","span2").append("input").attr("class","labelOnOff").attr("type","checkbox").on("change",r).node().checked=L,n.select("span.span2").append("label").text("node labels"),void 0!==x){M&&(console.log("nodeInfoKeys: "),console.log(b));var l=t.select("div.sankeyMenu").append("div").attr("class","NodeInfoMenu");l.append("div").attr("class","titleMenu").append("label").text("node info"),l=l.append("form").selectAll("span").data(b).enter().append("span"),l.append("input").attr("type","radio").attr("name","menu").attr("value",function(e){return e}).attr("checked",function(e,t){if(0===t)return"checked"}).on("change",function(){X=this.value,console.log("nodeInfokey: "+X),y()}),l.append("label").text(function(e){return e}),l.append("br")}}function s(){var e,n,o,s=t.transition().duration(1e3);q=t.select(".nodeScaling").node().checked,N.forEach(function(r,l){r.forEach(function(r,a){e=r.sankey,o=r.graph,q?e.maxValue(N.maxValue):e.maxValue(-1),e.layout(),n="g.sankeySeq.s"+l+"-"+a,t.select(n).selectAll(".link").data(o.links,function(e){return e.id}).transition(s).attr("d",e.link()).style("stroke-width",function(e){return Math.max(1,e.dy)+"px"}),t.select(n).selectAll(".node").data(o.nodes).transition(s).attr("transform",function(e){return"translate("+e.x+","+e.y+")"}),t.select(n).selectAll("rect.sankeyNode").transition(s).attr("height",function(e){return e.dy}),t.select(n).selectAll("text.nodeLabel").transition(s).attr("y",function(e){if(M){var n=i(t.select(this.parentNode).attr("transform"))[1];console.log("transform: "+t.select(this.parentNode).attr("transform")),console.log(n)}var o=parseInt(t.select(this).style("font-size"));return e.dy<o?e.dy-o/2-2:Math.min(e.dy/2,e.dy-o/2-2)}),t.select(n).selectAll("rect.sankeyNodeInfo").filter(function(n){return b.forEach(function(o){o!==O?n.nodeInfos[o+"_dy"]=e.getNodeHeight(+n.nodeInfos[o]):X===O&&t.selectAll("rect.sankeyNodeInfo").attr("y",function(e){return e.dy})}),void 0!==n.nodeInfos}).attr("height",function(){return t.select(this).attr("height")}).transition(s).attr("y",function(e){return X===O?e.dy:(M&&(console.log("value: "+ +e.nodeInfos[X]),console.log("newHeight: "+e.nodeInfos[X+"_dy"])),e.dy-e.nodeInfos[X+"_dy"])}).attr("height",function(e){return X===O?0:e.nodeInfos[X+"_dy"]})})})}function r(){t.selectAll("text.nodeLabel").style("display",function(){return t.select(".labelOnOff").node().checked?"block":"none"})}function y(){var e=t.transition().duration(1e3),n=t.select("rect.sankeyNodeInfo").style("fill"),o=t.color(n).rgb();o.opacity=.1,t.select("div.NodeInfoMenu").transition(e).style("border-color",function(){return X===O?"rgba(0,0,0,0.1)":n}).style("background-color",function(){return X===O?"rgba(0,0,0,0.1)":o.toString()}),t.selectAll("rect.sankeyNodeInfo").style("display","inline").transition(e).attr("y",function(e){return X===O?e.dy:(M&&(console.log("value: "+ +e.nodeInfos[X]),console.log("newHeight: "+e.nodeInfos[X+"_dy"])),e.dy-e.nodeInfos[X+"_dy"])}).attr("height",function(e){return X===O?0:e.nodeInfos[X+"_dy"]}).transition().delay(10).duration(10).style("display",function(){return X===O?"none":"inline"})}function h(e){var s,r,i,u,y,h,m,v,k,x,Y=!0;e.each(function(){o(e),x=t.select(this).append("div").attr("class","sankeyChart").append("svg").attr("width",V[0]).attr("height",V[1]).append("g").attr("transform","translate("+B.left+","+B.top+")"),v=d(x,V,B,E,I,P),1===N.cols&&1===N.rows&&(t.selectAll(".axis").style("opacity",1),t.selectAll(".sankeyNode,.sankeyNodeInfo").style("stroke-width","1px")),r=v.width,i=v.height,M&&(console.log("allGraphs:"),console.log(N)),N.forEach(function(e,o){e.forEach(function(e,d){m=e.graph,M&&(console.log("col: "+e.dimCol),console.log("row: "+e.dimRow)),s=l().size([r,i]).sequence(I).categories(E).nodeWidth(P).nodePadding(F).nodes(m.nodes).links(m.links).debugOn(M),q&&s.maxValue(N.maxValue),s.layout().addValues(),e.sankey=s,k=f(x,v,N,o,d),y=x.append("g").datum(k.sankeyFrame).attr("class","sankeyFrame f"+o+"-"+d).attr("transform",k.sankeyFrame.multiples).on("click",function(){1===N.cols&&1===N.rows||(Y=Y?p(this):g(this))}),u=y.append("g").datum(k.sankeySeq).attr("class","sankeySeq s"+o+"-"+d).attr("transform",k.sankeySeq.multiples);var S=y.append("g").datum(k.pTop).attr("class","sankeyPad multiples pTop").attr("transform",k.pTop.multiples);S.append("text").attr("class","multiples col c"+o).text(function(){return 1===N.cols&&N.rows>1?e.dimRow:e.dimCol}),S.append("text").attr("class","single col c"+o).style("opacity",0).text(function(){return 1===N.cols&&N.rows>1?e.dimRow:e.dimRow+"    "+e.dimCol}),y.append("g").datum(k.pLeft).attr("class","sankeyPad multiples pLeft").attr("transform",k.pLeft.multiples).append("text").attr("class","multiples row r"+d).attr("transform","rotate(-90)").text(function(){var t="";return N.cols>1&&N.rows>1&&(t=e.dimRow),t}),u.append("rect").attr("class","coverSankeySeq").attr("height",i).attr("width",r+2).style("stroke","black").style("stroke-width",1).style("fill-opacity",0),A=t.select("body").append("div").attr("class","tooltip"),u.append("g").selectAll(".link").data(m.links).enter().append("path").attr("class",function(e){return"link lsx"+e.source.nameX.replace(/ /g,"_")+" lsy"+e.source.nameY.replace(/ /g,"_")+" ltx"+e.target.nameX.replace(/ /g,"_")+" lty"+e.target.nameY.replace(/ /g,"_")}).attr("d",s.link()).style("stroke-width",function(e){return Math.max(1,e.dy)+"px"}).sort(function(e,t){return t.dy-e.dy}).on("mouseover",function(e){var t=C+": "+e.source.nameX+" ⇾ "+e.target.nameX;t+="<br>"+T+": "+e.source.nameY+" ⇾ "+e.target.nameY,t+="<br>"+w+": "+c(e.value,W,",.0f"),A.html(t),A.style("visibility","visible")}).on("mousemove",function(){var e=19,n=19,o=A.style("width").indexOf("px");-1!=o&&(e+=+A.style("width").substr(0,o)),-1!=(o=A.style("height").indexOf("px"))&&(n+=+A.style("height").substr(0,o));var s=t.event.pageY-100<0?t.event.pageY+23:t.event.pageY-n,r=t.event.pageX+250<window.innerWidth?t.event.pageX+5:t.event.pageX-e;return A.style("top",s+"px").style("left",r+"px")}).on("mouseout",function(){return A.style("visibility","hidden")}),h=u.append("g").selectAll(".node").data(m.nodes).enter().append("g").attr("class","node").attr("transform",function(e){return"translate("+e.x+","+e.y+")"}),h.append("rect").attr("class",function(e){var t="sankeyNode nx"+e.nameX.replace(/ /g,"_")+" ny"+e.nameY.replace(/ /g,"_");return n.categories().forEach(function(n,o){n===e.nameY&&(t+=" color"+o%5)}),t}).attr("height",function(e){return e.dy}).attr("width",s.nodeWidth()).on("mouseover",function(e){var t=C+": "+e.nameX;t+="<br>"+T+": "+e.nameY,t+="<br>"+w+": "+c(e.value,W,",.0f"),_.forEach(function(n){"%event"===n?t+="<br>% of '"+e.nameX+"': "+c(""+e.value/e.valueX,W,",.1%"):"%prevCategory"===n?t+="<br>% of previous '"+e.nameY+"': "+c(""+e.value/e.valueYPrev,W,",.1%"):"%firstCategory"===n&&(t+="<br>% of first '"+e.nameY+"': "+c(""+e.value/e.valueYFirst,W,",.1%"))}),A.html(t),A.style("visibility","visible")}).on("mousemove",function(){a(A)}).on("mouseout",function(){return A.style("visibility","hidden")}),h.append("text").attr("class","nodeLabel").style("display",function(){return t.select(".labelOnOff").node().checked?"block":"none"}).attr("x",3+s.nodeWidth()).attr("y",function(e){return e.dy/2}).attr("dy",".35em").attr("text-anchor","start").attr("transform",null).style("opacity",0).text(function(e){return e.nameY}).each(function(){M&&(console.log(t.select(this.parentNode).node()),console.log("transform: "+t.select(this.parentNode).attr("transform")));var e=parseInt(t.select(this).style("font-size"));t.select(this).attr("y",function(t){return t.dy<e?t.dy-e/2-2:Math.min(t.dy/2,t.dy-e/2-2)})}).filter(function(e){return e.x>.9*r}).attr("x",-3).attr("text-anchor","end"),h.filter(function(e){return void 0!==e.nodeInfos}).append("rect").attr("class","sankeyNodeInfo").attr("y",function(e){return e.dy}).attr("height",function(e){return b.forEach(function(t){t!==O&&(e.nodeInfos[t+"_dy"]=s.getNodeHeight(+e.nodeInfos[t]))}),0}).attr("width",s.nodeWidth()).style("display",function(){return X===O?"none":"inline"}).on("mouseover",function(e){var t=C+": "+e.nameX;t+="<br>"+T+": "+e.nameY,t+="<br>"+w+" ("+X+"): "+c(e.nodeInfos[X],W,",.0f"),t+="<br>% of node: "+c(""+e.nodeInfos[X]/e.value,W,",.1%"),A.html(t),A.style("visibility","visible")}).on("mousemove",function(){a(A)}).on("mouseout",function(){return A.style("visibility","hidden")}),"single"===e.transform&&p(y.node(),t.transition().duration(0))})})})}function m(e,n){if("<pre>"!==e)t.csv(e,function(o,s){var r=e.slice(0,e.lastIndexOf("."))+"_nodes"+e.slice(e.lastIndexOf("."));t.csv(r,function(e,t){M&&(console.log("start"),console.log(e),console.log(t),console.log("end")),x=t,k=s,M&&(console.log("file: "),console.log(k),console.log("nodeFileName: "),console.log(r),console.log("nodeFile: "),console.log(x)),N=v(k),h(n)})});else{if(k=t.csvParse(t.select("pre#data").text()),x=t.csvParse(t.select("pre#dataNodes").text()),0===x.length){x=void 0}M&&(console.log("file: "),console.log(k),console.log("nodeFile: "),console.log(x)),N=v(k),h(n)}}function v(e){var n,o,s,r,l,a,i,c,d={},f=[],p=e.columns,g=[],y=t.map(),h=0,m=t.set(),v=t.set();console.log(e.columns),void 0===w&&(w=e.columns[0]),5===e.columns.length?(g=t.nest().key(function(){return""}).key(function(){return""}).entries(e),void 0!==x&&(x.forEach(function(e){s=e.sourceX+","+e.sourceY,y.set(s,e),M&&console.log(e)}),b=x.columns,b.splice(0,2,O))):6===e.columns.length?(g=t.nest().key(function(){return""}).key(function(e){return e[p[5]]}).sortKeys(u(S)).entries(e),void 0!==x&&(x.forEach(function(t){s=t[e.columns[5]]+","+t.sourceX+","+t.sourceY,y.set(s,t),M&&console.log(t)}),b=x.columns,b.splice(0,3,O))):7===e.columns.length&&(g=t.nest().key(function(e){return e[p[6]]}).sortKeys(u(Y)).key(function(e){return e[p[5]]}).sortKeys(u(S)).entries(e),M&&console.log("----------- nodeInfos ------------"),void 0!==x&&(x.forEach(function(t){s=t[e.columns[6]]+","+t[e.columns[5]]+","+t.sourceX+","+t.sourceY,y.set(s,t),M&&console.log(t)}),b=x.columns,b.splice(0,4,O))),f.rows=t.nest().key(function(e){return e[p[5]]}).entries(e).length,f.cols=t.nest().key(function(e){return e[p[6]]}).entries(e).length,M&&(console.log("----------- datagroups ------------"),console.log(g),console.log("----------nodeMap----------"),console.log(y)),g.forEach(function(e,s){f[s]=[],e.values.forEach(function(u){r=u.values,d={nodes:[],links:[]},M&&console.log("graph0: "),r.forEach(function(e,t){M&&(console.log("i: "+t),console.log(e)),n=e[p[1]]+"_"+e[p[2]],o=e[p[3]]+"_"+e[p[4]],d.nodes.push({name:n}),d.nodes.push({name:o}),d.links.push({source:n,target:o,id:n+"->"+o,value:+e[p[0]]}),m.add(e[p[1]]),m.add(e[p[3]]),v.add(e[p[2]]),v.add(e[p[4]])}),M&&(console.log("graph1: "),console.log(JSON.stringify(d))),d.nodes=t.nest().key(function(e){return e.name}).map(d.nodes).keys(),M&&(console.log("graph2: "),console.log(JSON.stringify(d))),d.links.forEach(function(e,t){d.links[t].source=d.nodes.indexOf(d.links[t].source),d.links[t].target=d.nodes.indexOf(d.links[t].target)}),d.nodes.forEach(function(t,n){var o=t.split("_")[0],s=t.split("_")[1];d.nodes[n]={name:t,nameX:o,nameY:s};var r,l=""===e.key?"":e.key+",",a=""===u.key?"":u.key+",";void 0!==(r=y.get(l+a+o+","+s))&&(Object.keys(r).forEach(function(e){r[e+"_dy"]=0}),d.nodes[n].nodeInfos=r)}),M&&(console.log("graph 3"),console.log(JSON.stringify(d)),console.log(d)),M&&(console.log("categoriesSorted: "),console.log(E)),l={},l.graph=d,l.dimRow=u.key,l.dimCol=e.key,a=t.nest().key(function(e){return e.source}).rollup(function(e){return t.sum(e,function(e){return+e.value})}).entries(d.links),i=t.nest().key(function(e){return e.target}).rollup(function(e){return t.sum(e,function(e){return+e.value})}).entries(d.links),a=a.concat(i),c=t.max(a,function(e){return e.value}),h=c>h?c:h,1===f.cols&&1===f.rows?l.transform="single":l.transform="multiples",f[s].push(l)})});var k=m.values().sort(t.ascending),N=v.values().sort(t.ascending);return console.log(" data sequence: "+k),I?console.log("input sequence: "+I):I=k,console.log(" data categories: "+N),E?console.log("input categories: "+E):E=N,M&&console.log("maxValue: "+h),f.maxValue=h,f}var k,x,b,w,N,A,I,E,Y,S,O="(none)",X=O,q=!0,L=!0,_=[],M=!1,P=15,F=8,V=[700,500],B={left:5,top:5,right:5,bottom:5},C="sequence",T="category",W=",";return n.debugOn=function(e){return arguments.length?(M=e,n):M},n.size=function(e){return arguments.length?(V=e,n):V},n.margin=function(e){return arguments.length?(B.left=e,B.top=e,B.right=e,B.bottom=e,n):B},n.nodeWidth=function(e){return arguments.length?(P=+e,n):P},n.nodePadding=function(e){return arguments.length?(F=+e,n):F},n.sequence=function(e){return arguments.length?(I=e,n):I},n.categories=function(e){return arguments.length?(E=e,n):E},n.sequenceName=function(e){return arguments.length?(C=e,n):C},n.categoryName=function(e){return arguments.length?(T=e,n):T},n.valueName=function(e){return arguments.length?(w=e,n):w},n.thousandsSeparator=function(e){return arguments.length?(W=e,n):W},n.scaleGlobal=function(e){return arguments.length?(q=e,n):q},n.showNodeLabels=function(e){return arguments.length?(L=e,n):L},n.tooltipFormat=function(e){return arguments.length?(_=e,n):_},n.rowOrder=function(e){return arguments.length?(S=e,n):S},n.colOrder=function(e){return arguments.length?(Y=e,n):Y},n}e.chart=y,Object.defineProperty(e,"__esModule",{value:!0})});